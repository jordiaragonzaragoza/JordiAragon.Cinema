IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;


BEGIN TRANSACTION;


CREATE TABLE [Auditoriums] (
    [Id] uniqueidentifier NOT NULL,
    [Name] nvarchar(max) NULL,
    [Rows] int NOT NULL,
    [SeatsPerRow] int NOT NULL,
    [Version] rowversion NULL,
    CONSTRAINT [PK_Auditoriums] PRIMARY KEY ([Id])
);


CREATE TABLE [IdempotentConsumers] (
    [Id] uniqueidentifier NOT NULL,
    [MessageId] uniqueidentifier NOT NULL,
    [ConsumerFullName] nvarchar(max) NULL,
    CONSTRAINT [PK_IdempotentConsumers] PRIMARY KEY ([Id])
);


CREATE TABLE [Movies] (
    [Id] uniqueidentifier NOT NULL,
    [Title] nvarchar(max) NULL,
    [Runtime] time NOT NULL,
    [StartingExhibitionPeriodOnUtc] datetimeoffset NULL,
    [EndOfExhibitionPeriodOnUtc] datetimeoffset NULL,
    [Version] rowversion NULL,
    CONSTRAINT [PK_Movies] PRIMARY KEY ([Id])
);


CREATE TABLE [OutboxMessages] (
    [Id] uniqueidentifier NOT NULL,
    [DateOccurredOnUtc] datetimeoffset NOT NULL,
    [Type] nvarchar(max) NULL,
    [Content] nvarchar(max) NULL,
    [DateProcessedOnUtc] datetimeoffset NULL,
    [Error] nvarchar(max) NULL,
    [Version] rowversion NULL,
    CONSTRAINT [PK_OutboxMessages] PRIMARY KEY ([Id])
);

CREATE TABLE [Showtimes] (
    [Id] uniqueidentifier NOT NULL,
    [MovieId] uniqueidentifier NULL,
    [SessionDateOnUtc] datetimeoffset NOT NULL,
    [AuditoriumId] uniqueidentifier NULL,
    [IsEnded] bit NOT NULL,
    [Version] rowversion NULL,
    CONSTRAINT [PK_Showtimes] PRIMARY KEY ([Id])
);

CREATE TABLE [Users] (
    [Id] uniqueidentifier NOT NULL,
    [Version] rowversion NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id])
);


CREATE TABLE [AuditoriumsSeats] (
    [Id] uniqueidentifier NOT NULL,
    [AuditoriumId] uniqueidentifier NOT NULL,
    [Row] smallint NOT NULL,
    [SeatNumber] smallint NOT NULL,
    CONSTRAINT [PK_AuditoriumsSeats] PRIMARY KEY ([Id], [AuditoriumId]),
    CONSTRAINT [FK_AuditoriumsSeats_Auditoriums_AuditoriumId] FOREIGN KEY ([AuditoriumId]) REFERENCES [Auditoriums] ([Id]) ON DELETE CASCADE
);


CREATE TABLE [AuditoriumsShowtimeIds] (
    [AuditoriumId] uniqueidentifier NOT NULL,
    [Id] int NOT NULL IDENTITY,
    [ShowtimeId] uniqueidentifier NOT NULL,
    CONSTRAINT [PK_AuditoriumsShowtimeIds] PRIMARY KEY ([AuditoriumId], [Id]),
    CONSTRAINT [FK_AuditoriumsShowtimeIds_Auditoriums_AuditoriumId] FOREIGN KEY ([AuditoriumId]) REFERENCES [Auditoriums] ([Id]) ON DELETE CASCADE
);


CREATE TABLE [MoviesShowtimeIds] (
    [MovieId] uniqueidentifier NOT NULL,
    [Id] int NOT NULL IDENTITY,
    [ShowtimeId] uniqueidentifier NOT NULL,
    CONSTRAINT [PK_MoviesShowtimeIds] PRIMARY KEY ([MovieId], [Id]),
    CONSTRAINT [FK_MoviesShowtimeIds_Movies_MovieId] FOREIGN KEY ([MovieId]) REFERENCES [Movies] ([Id]) ON DELETE CASCADE
);

CREATE TABLE [ShowtimesTickets] (
    [Id] uniqueidentifier NOT NULL,
    [ShowtimeId] uniqueidentifier NOT NULL,
    [UserId] uniqueidentifier NULL,
    [CreatedTimeOnUtc] datetimeoffset NOT NULL,
    [IsPurchased] bit NOT NULL,
    CONSTRAINT [PK_ShowtimesTickets] PRIMARY KEY ([Id], [ShowtimeId]),
    CONSTRAINT [FK_ShowtimesTickets_Showtimes_ShowtimeId] FOREIGN KEY ([ShowtimeId]) REFERENCES [Showtimes] ([Id]) ON DELETE CASCADE
);

CREATE TABLE [ShowtimeTicketSeatIds] (
    [TicketId] uniqueidentifier NOT NULL,
    [ShowtimeId] uniqueidentifier NOT NULL,
    [Id] int NOT NULL IDENTITY,
    [SeatId] uniqueidentifier NOT NULL,
    CONSTRAINT [PK_ShowtimeTicketSeatIds] PRIMARY KEY ([TicketId], [ShowtimeId], [Id]),
    CONSTRAINT [FK_ShowtimeTicketSeatIds_ShowtimesTickets_TicketId_ShowtimeId] FOREIGN KEY ([TicketId], [ShowtimeId]) REFERENCES [ShowtimesTickets] ([Id], [ShowtimeId]) ON DELETE CASCADE
);


CREATE INDEX [IX_AuditoriumsSeats_AuditoriumId] ON [AuditoriumsSeats] ([AuditoriumId]);

CREATE INDEX [IX_ShowtimesTickets_ShowtimeId] ON [ShowtimesTickets] ([ShowtimeId]);

INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion]) VALUES 
(N'20240510160705_InitialBusinessModelStoreMigration', N'7.0.14');


INSERT INTO [Auditoriums] ([Id], [Name], [Rows], [SeatsPerRow]) VALUES 
(N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',N'Auditorium One',10,10);


INSERT INTO [AuditoriumsSeats] ([Id], [AuditoriumId], [Row], [SeatNumber]) VALUES 
	 
	 (N'818729B3-1521-4CB4-A438-007B69C87F14',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,2),
	 (N'3175F25B-D938-4298-BF22-00B7A475930B',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,9),
	 (N'A33060CB-BA65-4E47-AED2-053F92CF3648',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,8),
	 (N'0B88B01A-8525-4820-9805-06D872C803CB',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,8),
	 (N'D1808D96-F91B-43C4-8F56-09B96E85A1EE',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,10),
	 (N'1E3ACF8C-B027-4409-9596-0DA0AB4DFAA1',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,1),
	 (N'501B0A65-0D76-4D02-A831-0F43AA82D323',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,4),
	 (N'BD21D103-65D6-43AA-8707-110946D87486',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,5),
	 (N'A3DD37AB-B93E-4350-B79D-11FA16807251',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,3),
	 (N'21088AB7-6D8A-4D55-9A4C-1482E93DFD7A',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,3),

	 (N'B51023FD-0B55-4D01-BCCF-165CEADBC42E',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,8),
	 (N'16E3546F-1953-4E0D-94A2-17FD5A113DBF',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,10),
	 (N'5772778B-B4FA-4683-BB86-1F9EB45BDEA7',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,4),
	 (N'13DE6CAC-882C-4E97-8768-28B8949DBA69',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,6),
	 (N'9F9D5A33-1F37-4EFE-B558-2E7175083D62',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,9),
	 (N'72E2F0CF-FAE7-4B97-B415-313EC59AFEA5',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,4),
	 (N'C3F85E67-C166-4835-85A5-37A0D4EE5A11',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,4),
	 (N'EA2402BF-4AA5-4045-9E9E-37DAF7121591',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,8),
	 (N'871B218D-2547-4875-A503-3911C8AFE02B',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,2),
	 (N'77FAD68C-9F83-4EB2-946A-39E8BDB893F0',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,5),

	 (N'E322B680-A82A-452B-9C08-3AE347492A03',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,10),
	 (N'4B98075D-819F-4C02-991B-3CA9D3E176E8',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,10),
	 (N'FF5B4072-C941-490E-87FB-3E037C5DDC9D',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,10),
	 (N'ED2CB507-860C-45CD-B60F-4232ACE22A57',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,5),
	 (N'F86158F8-B9E0-4DEA-B95D-45BD178FFAC4',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,6),
	 (N'98D030BA-CAA5-462A-BC0C-484845EFDD1F',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,1),
	 (N'23EB0537-12BC-48D5-850D-485A761CF697',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,6),
	 (N'7426CB76-1981-42A1-B1C6-4C55612A859E',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,8),
	 (N'8EB4625F-8A72-4BA8-9AFD-4E4209D648A0',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,6),
	 (N'3182C1CF-158F-401B-9FCD-509401ADC4AB',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,4),

	 (N'0D9A47AD-215B-4520-9244-516672E53FA1',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,3),
	 (N'828082D5-4E86-44A6-A4AE-522260AF5A29',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,5),
	 (N'751D609F-04A6-455D-BAA4-55DDC124FCDC',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,1),
	 (N'BFBEB9D5-580C-4200-8A0E-57A3E3249C75',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,10),
	 (N'8C58B36A-B574-449F-89DE-5A7D6CB1D4BA',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,8),
	 (N'4162FF86-BF72-4466-AFC6-603F0B5E0F6C',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,6),
	 (N'6D190939-6FC9-48D2-BF19-624E8C5B80A3',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,4),
	 (N'2CBAAF0A-13DF-4A37-829B-625F10C4B443',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,9),
	 (N'41E4CA8F-9A64-467F-9EAB-652617E74D70',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,9),
	 (N'1B8D35ED-2086-460D-BA6D-65A123F5C8FD',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,4),

	 (N'2A7FD6D7-F7BC-43A8-9E96-663E63D7B48D',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,3),
	 (N'99104C7C-7304-4ACA-999D-67C9DF989417',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,2),
	 (N'EB5BA740-11C6-464B-A711-6A46B78716AB',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,1),
	 (N'6F8C5B1E-F9FC-4379-BB11-6BC7037C2E59',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,6),
	 (N'4D8B29CA-6A17-4C9B-8DC5-6E0CDCD3980F',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,2),
	 (N'3374CD40-A82D-45BC-BDD9-74D701EEAF38',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,7),
	 (N'426AEB2F-147E-4103-A030-76E085483BB1',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,5),
	 (N'D9E278CF-1EB3-4D8A-8A2F-7A17DBB41D88',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,3),
	 (N'68FC8DEE-6184-4C31-BC74-861CB0CCCC28',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,1),
	 (N'350F9FF9-0D63-49E2-802A-870D44A3B7BD',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,8),

	 (N'C2A687B2-E22F-4836-BF1D-88A113D882E8',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,8),
	 (N'970B16EE-1B3F-49B5-B02D-8BE5E9070515',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,2),
	 (N'5D8FEBB6-F0EE-4E46-B18A-8E8DBEB4071E',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,5),
	 (N'44F048D3-D706-4EF0-886A-91B8ABEB12E0',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,9),
	 (N'1771A2DD-415E-4EB9-A47D-936C6F9BCE91',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,5),
	 (N'77A61020-D262-4816-A81B-9ACA540663B5',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,1),
	 (N'B62FD17C-0AD7-45B6-8AC4-9B51CA0EF945',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,7),
	 (N'3AF457E4-CF3B-4E05-9448-9C9F66256EC1',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,10),
	 (N'2A31A3B6-CD01-412E-9C74-A07B745992E7',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,2),
	 (N'FE6BC5C5-93C2-4F98-8BEE-A34E24DEDFC6',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,8),

	 (N'D138C9B9-7B4F-4126-BEA6-A655DCFCFF07',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,2),
	 (N'DA78C264-8EE1-43DB-95CA-A9EF644D8790',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,6),
	 (N'9CDE7A47-EDC2-4F49-BCE7-ADDE70A976A0',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,1),
	 (N'E0F66852-DDD4-49DB-8C04-B067DF463E34',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,4),
	 (N'DB12F1AC-DCC7-4412-BC05-B14CE25926C9',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,6),
	 (N'4A7FF58B-3024-4F44-BCFE-B620BEA44DA7',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,3),
	 (N'72FC9A51-EBAB-4D7D-9005-B99D44F2B1B1',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,1),
	 (N'A449D1AB-549E-40E9-80F6-BFE363274DD6',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,9),
	 (N'FCE2C2F6-B110-4FAF-88EE-C82BE0454AD2',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,9),
	 (N'8479C542-8789-4DB7-8AFE-C8DDACF86EBD',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,1),

	 (N'AB8E618D-4B49-40E2-AC1D-CA0F9C448519',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,10),
	 (N'F432027E-95E3-46AE-B403-CA86AAF92296',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,3),
	 (N'242FCDE2-03E0-44F0-8AF0-CC077E7D7C6E',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',1,5),
	 (N'426D09C4-1CAB-4105-94F5-CD4FDB183523',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,3),
	 (N'AEEF1A4A-1F50-41F6-A5EE-CFE9F07B45B2',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,5),
	 (N'134B85DD-7C4E-40B7-A2F1-D3E2DAD95D2F',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,6),
	 (N'AEB87E5A-8194-45C3-B59C-DBFC20C84D1B',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,2),
	 (N'CF7728B0-20DD-4ECB-8A5B-DCF1735E5B98',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,3),
	 (N'69C41A02-974B-4CFC-AD8B-DDC66F4BA79D',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,10),
	 (N'5263E0AF-C801-488C-9AA2-DE389642B14E',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',4,7),

	 (N'258DB66F-763B-46F6-9461-DE3EAD6D9DDD',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,7),
	 (N'4FA3F996-393E-4C9B-98BE-E11AA3AC1644',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,7),
	 (N'EE046963-F88D-4F15-AEFC-E17A01777002',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',9,7),
	 (N'406B8D61-A073-4D14-8C6B-E1EE67D0A9F3',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,7),
	 (N'196A85E8-5ADD-4340-ABB8-E1EEBD8ADFB5',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,1),
	 (N'7800857E-7388-4601-91EE-E2BB78AD458F',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,3),
	 (N'1025E967-B185-4E52-94E2-E3EC5AEA8862',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,4),
	 (N'6B98FE80-85AB-4B71-8148-E578EEA44BEB',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,6),
	 (N'D60E42C7-AD07-43C5-87B2-E5890DA4BA37',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,2),
	 (N'B8F6555A-60DB-4B01-BA44-E8538C566555',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,7),

	 (N'DFD3E894-35B2-4420-B723-E8AA8DCDFDE7',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',2,2),
	 (N'8E45292C-12DF-490F-9863-EAE1C9F8A62A',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,9),
	 (N'FEF693A5-0F81-4EB5-A29C-ED3DDC4305AC',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,7),
	 (N'BA6DD9CE-A1F9-42B4-9C60-F64993316574',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,8),
	 (N'2497BD0C-CA38-44C9-945D-F92B731293B1',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',6,9),
	 (N'4144C240-B0FD-474E-B8A5-FB0070FA8235',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',10,5),
	 (N'9AEE9EB0-875C-483B-84E7-FB0C523A8014',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',3,4),
	 (N'6C9EEA62-FC27-44E7-9C45-FCFD84EEACF3',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',7,10),
	 (N'85C6143F-11A9-489A-86D3-FE00988119F4',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',8,9),
	 (N'126A1747-F947-4741-8676-FEB30E92D2C9',N'C91AA0E0-9BC0-4DB3-805C-23E3D8EABF53',5,7);


INSERT INTO [Movies] ([Id], [Title], [Runtime], [StartingExhibitionPeriodOnUtc], [EndOfExhibitionPeriodOnUtc]) VALUES 
	 (N'3FA85F64-5717-4562-B3FC-2C963F66AFA6',N'Inception','02:28:00.0000000','2025-01-01 01:01:01.0000000 +00:00','2026-06-06 18:35:32.4841043 +00:00');


INSERT INTO [Users] ([Id]) VALUES 
	 (N'08FFDDF5-3826-483F-A806-B3144477C7E8');


COMMIT;


